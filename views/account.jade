extends templates/layout

block content
  if !enoughChaperones
    #alert.alert.alert-danger You don't have enough Chaperones to support all of your youth. Please find some more!
  #listing.container
    .row
      .table-responsive
        table.table.table-striped
          thead
            tr
              th Name
              th Type
              th Information
              th Workshops
              th Remove
          tbody
            if members.length > 0
              for member in members
                tr
                  td= member.name
                  td
                    case member.type
                      when "Youth"
                        .label.label-info Y
                      when "Young Adult"
                        .label.label-success YA
                      when "Young Chaperone"
                        .label.label-warning YC
                      when "Chaperone"
                        .label.label-danger Ch
                      default
                        .label.label-default NA
                  td
                    if member._state.complete
                      a.edit.btn.btn-xs.btn-success.tooltipped(data-id=member._id, data-toggle="tooltip", title="Edit Info") Complete 
                    else
                      a.edit.btn.btn-xs.btn-danger.tooltipped(data-id=member._id, data-toggle="tooltip", title="Edit Info") Incomplete
                  td
                    if member._workshops.length >= 4
                      a.btn.btn-xs.btn-success.tooltipped(href="/workshops", data-toggle="tooltip", title="Browse Workshops") 4+ Workshops
                    else if member._workshops.length >= 1
                      a.btn.btn-xs.btn-warning.tooltipped(href="/workshops", data-toggle="tooltip", title="Browse Workshops") 1+ Workshops
                    else
                      a.btn.btn-xs.btn-default.tooltipped(href="/workshops", data-toggle="tooltip", title="Browse Workshops") No Workshops!
                  td
                    form(method="POST", action="/member/#{member._id}")
                      input(type="hidden", name="_method", value="delete")
                      button.btn.btn-xs.btn-danger.tooltipped(data-toggle="tooltip", title="There is no undo!")
                        i.icon-trash
                        |  Delete
            else
              tr
                td.warning(colspan="5") You currently don't have any members. To add members, please hit the big green "Add a member" button.
    #controls.container
      .row(style="text-align: center")
        .btn-group
          a#add.btn.btn-success.btn-large(data-toggle="collapse", data-parent="#panels", href="#member") 
            i.icon-plus
            |  Add a member
          a.btn.btn-info.btn-large(data-toggle="collapse", data-parent="#panels", href="#details") 
            i.icon-edit
            |  Edit Group Details
  br
  #panels.panel-group
    .panel
      #member.collapse.container
        include templates/member.jade

    .panel
      #details.collapse.container
        form(action="/account", method="POST")
          input(type="hidden", name="_method", value="put")
          fieldset
            legend(style="text-align: center") Login Details
            p(style="text-align: center") Please don't fill in the password unless you intend to change it!
            .row
              .col-sm-2
              .col-sm-4
                .form-group
                  label Email
                  input.form-control(type="email", name="email", placeholder="someone@somewhere.ca", value="#{session.group.email}")
              .col-sm-4
                .form-group
                  label Password
                  input.form-control(type="password", name="password", placeholder="°°°°°°°°")
                .form-group
                  label Password Confirm
                  input.form-control(type="password", name="passwordConfirm", placeholder="°°°°°°°°")
          fieldset
            legend(style="text-align: center") Group Details
            .row
              .col-sm-2
              .col-sm-4
                .form-group
                  label Primary Contact Name
                  input.form-control(type="text", name="name", placeholder="Foo Bar", value="#{session.group.name}")
                .form-group
                  label Affiliation
                  input.form-control(type="text", name="affiliation", placeholder="Some Organization", value="#{session.group.affiliation}")
                .form-group
                  label Street Address
                  input.form-control(type="text", name="address", placeholder="123 Fake St.", value="#{session.group.address}")
                .form-group
                  label City
                  input.form-control(type="text", name="city", placeholder="Vancouver", value="#{session.group.city}")
              .col-sm-4
                .form-group
                  label Province
                  select.form-control(name="province")
                    option(value="", selected=session.group.province == "") Please choose...
                    option(value="British Columbia", selected=session.group.province == "British Columbia") British Columbia
                    option(value="Alberta", selected=session.group.province == "Alberta") Alberta
                    option(value="Saskatchewan", selected=session.group.province == "Saskatchewan") Saskatchewan
                    option(value="Manitoba", selected=session.group.province == "Manitoba") Manitoba
                    option(value="Ontario", selected=session.group.province == "Ontario") Ontario
                    option(value="Quebec", selected=session.group.province == "Quebec") Quebec
                    option(value="New Brunswick", selected=session.group.province == "New Brunswick") New Brunswick
                    option(value="Nova Scotia", selected=session.group.province == "Nova Scotia") Nova Scotia
                    option(value="Prince Edward Island", selected=session.group.province == "Prince Edward Island") Prince Edward Island
                    option(value="Newfoundland and Labrador", selected=session.group.province == "Newfoundland and Labrador") Newfoundland and Labrador
                    option(value="Nunavut", selected=session.group.province == "Nunavut") Nunavut
                    option(value="Northwest Territories", selected=session.group.province == "Northwest Territories") Northwest Territories
                    option(value="Yukon", selected=session.group.province == "Yukon") Yukon
                    option(value="Other (Outside Canada)", selected=session.group.province == "Other (Outside Canada)") Other (Outside Canada)
                .form-group
                  label Postal Code
                  input.form-control(type="text", name="postalCode", placeholder="A1B 2C3", value="#{session.group.postalCode}")
                .form-group
                  label Daytime Phone #
                  input.form-control(type="text", name="phone", placeholder="(123) 456-7980", value="#{session.group.phone}")
                .form-group
                  label Fax # (Optional)
                  input.form-control(type="text", name="fax", placeholder="(123) 456-7890", value="#{session.group.fax}")
          .row
            .col-sm-4
            .form-group.col-sm-4
              button.btn.btn-primary.btn-block(type="submit")
                i.icon-edit
                |  Update Details
  :coffee
    $(".tooltipped").tooltip()
    $("a.edit").click -> 
      $.get "/member?id=#{$(this).data("id")}", (data) =>
        $("#member").html(data).collapse('show')
    $("a#add").click ->
      $.get "/member", (data) =>
        $("#member").html(data).collapse('toggle')