if message
    p.alert.alert-warning= message
if session.group._members.length == 0
    p.text-muted There are no members in this group, you should add some first!
else
    .container(id= workshopSession)
        br
        for member in session.group._members
            .row
                .col-xs-1
                    span
                        case member.type
                            when "Youth"
                                .label.label-info Y
                            when "Young Adult"
                                .label.label-success YA
                            when "Young Chaperone"
                                .label.label-warning YC
                            when "Chaperone"
                                .label.label-danger Ch
                            default
                                .label.label-default NA
                .col-xs-5
                    b= member.name
                .col-xs-5
                    -var conflicts = member.hasConflicts(workshop._id, workshopSession)
                    -var members = workshop.session(workshopSession)._registered.map(function(val) { if (val && val._id) { return String(val._id); } else { return String(val); }; })
                    if member.type == null || member.type == undefined || member.type == ""
                        a.btn.btn-xs.btn-default.btn-disabled.btn-block(href="/account") Complete Info
                    else if workshop.allows.indexOf(member.type) == -1
                        .btn.btn-xs.btn-warning.btn-disabled.btn-block Ineligible
                    else if members.indexOf(String(member._id)) != -1
                        a.remove.btn.btn-xs.btn-danger.btn-block(data-member="#{member._id}", data-workshop="#{workshop._id}", data-session="#{workshopSession}")
                            .fa.fa-minus
                            |   Remove Member
                    else if workshop.session(workshopSession)._registered.length >= workshop.session(workshopSession).capacity
                        a.btn.btn-xs.btn-default.btn-block
                            .fa.fa-dot-circle-o
                            |   Workshop Full
                    else if !conflicts && member._state.complete
                        a.add.btn.btn-xs.btn-success.btn-block(data-member="#{member._id}", data-workshop="#{workshop._id}", data-session="#{workshopSession}")
                            .fa.fa-plus
                            |   Add Member
                    else if !conflicts
                        a.add.btn.btn-xs.btn-success.btn-block(data-member="#{member._id}", data-workshop="#{workshop._id}", data-session="#{workshopSession}")
                            .fa.fa-plus
                            |   Add (BYPASS)
                    else if conflicts
                        -var message = "The conflicting workshop is in session " + conflicts.session
                        a(href="/workshop/#{conflicts._id}?message=#{message}").btn.btn-xs.btn-warning.btn-disabled.btn-block View Conflict
                    else
                        a.btn.btn-xs.btn-default.btn-disabled.btn-block(href="/account") Complete Info
            br
if session.isAdmin
    p.lead All Members
    for member in workshop.session(workshopSession)._registered
        .row
            .col-xs-1
                span
                    case member.type
                        when "Youth"
                            .label.label-info Y
                        when "Young Adult"
                            .label.label-success YA
                        when "Young Chaperone"
                            .label.label-warning YC
                        when "Chaperone"
                            .label.label-danger Ch
                        default
                            .label.label-default NA
            .col-xs-5
                p
                    b= member.name
                p.muted= member.email
                p.muted= member._group
            .col-xs-5
                a.remove.btn.btn-xs.btn-danger.btn-block(data-member="#{member._id}", data-workshop="#{workshop._id}", data-session="#{workshopSession}")
                    .fa.fa-minus
                    |  Remove Member
                br

script.
    $(function() {
        'use strict';
        $('.remove').unbind('click').click(function() {
            var member = $(this).data('member'),
                workshop = $(this).data('workshop'),
                session = $(this).data('session');
            // Disable the buttons until we hear back.
            $('#' + $(this).data('session') + ' div a').unbind('click').text('Confirming...');
            $.get('/member/' + member + '/del/' + workshop + '/' + session, function(data) {
                $('#' + session + '-attending').html(data);
            });
        });
        $('.add').unbind('click').click(function() {
            var member = $(this).data('member'),
                workshop = $(this).data('workshop'),
                session = $(this).data('session');
            // Disable the buttons until we hear back.
            $('#' + $(this).data('session') + ' div a').unbind('click').text('Confirming...');
            $.get('/member/' + member + '/add/' + workshop + '/' + session, function(data) {
                $('#' + session + '-attending').html(data);
            });
        });
    });
